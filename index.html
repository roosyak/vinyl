<!DOCTYPE html>
<html lang="ru">

<head>
	<title>Виниловые пластинки Апатиты Кировск</title>
	<script src="https://unpkg.com/vue"></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="favicon.ico" />
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<div id="app">
		<ul class="menu">
			<li>
				<input type="search" v-model="search" placeholder="Поиск">
			</li>
			<li>
				Сортировать по
				<a @click="sortParam='artist'" :class="sortParam==='artist'? 'act' : ''">исполнителю</a>,
				<a @click="sortParam='title'" :class="sortParam==='title'? 'act' : ''">альбому</a>,
				<a @click="sortParam='folder'" :class="sortParam==='folder'? 'act' : ''">цене</a>
			</li>
			<li v-show="count>0">
				<label>
					<input type="checkbox" v-model="selected">
					{{count}} шт &nbsp; <b>{{sum}}</b> руб
				</label>
			</li>
		</ul>

		<div v-if="selected">
			{{checkeds}}
		</div>

		<div v-else v-for="x in sortedList" v-bind:key="x.id">
			<div class="item">
				<div class="clear">
					<div class="img">
						<label>
							<input type="checkbox" v-model="checkeds" :value="x.ID">
							<img :src="x.thumb">
						</label>
						<div class="prs">
							<font class="rub">{{ x.folder }}</font>
						</div>
					</div>
					<div class="info">
						<p><a :href="x.uri" target="_blank">{{ x.artist }} &mdash; {{ x.title }}</a></p>
						{{ x.released > 0 ? x.released + ' г.' : ''}}
						<i :title="x.country">{{x.labels[0].name}}</i>
						<p class="genres">
							<font v-for="g in x.genres">{{g}}</font>
							<font v-for="s in x.styles">{{s}}</font>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		var app = new Vue({
			el: '#app',
			data: {
				search: '',
				sortParam: 'artist',
				vinyls: [],
				checkeds: [],
				selected: false
			},
			created() {
				fetch('collection.json')
					.then(response => response.json())
					.then(json => {
						this.vinyls = json;
						this.vinyls.forEach(e => {
							e.released = +e.released;
							e.folder = e.notes ? +e.notes : +e.folder;
							e.checked = false;
							e.str = (e.artist + ' ' + e.title + ' ' + e.genres + ' ' + e.styles).toLowerCase();
						})
					})
			},
			methods: {
			},
			computed: {
				count() {
					return this.checkeds.length;
				},
				sum() {
					var s = 0;
					this.vinyls.forEach(e => {
						if (this.checkeds.indexOf(e.ID) != -1)
							s += e.folder
					})
					return s;
				},
				sortedList() {
					var srch = this.search.trim().toLowerCase();
					var v = !srch ? this.vinyls :
						this.vinyls.filter(item => {
							return item.str.indexOf(srch) > -1
						})
					switch (this.sortParam) {
						case 'artist': return v.sort(sortByA);
						case 'title': return v.sort(sortByT);
						case 'folder': return v.sort(sortByF);
						default: return v.sort(sortByA);
					}
				}
			}
		})
		var sortByA = (a, b) => { return (a.artist.toLowerCase() > b.artist.toLowerCase()) ? 1 : -1; };
		var sortByT = (a, b) => { return (a.title.toLowerCase() > b.title.toLowerCase()) ? 1 : -1; };
		var sortByF = (a, b) => { return (a.folder > b.folder) ? 1 : -1; };
	</script>
</body>

</html>