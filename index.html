<!DOCTYPE html>
<html lang="ru">

<head>
	<title>Виниловые пластинки Апатиты Кировск</title>
	<script src="https://unpkg.com/vue"></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="favicon.ico" />
	<link href="style.css?202120218" rel="stylesheet">
	<!-- https://fontawesome.com/icons -->
	<link href="/wf/css/all.css" rel="stylesheet">
</head>

<body>
	<div id="app">
		<ul class="menu">
			<li>
				<input type="search" v-model="search" placeholder="Поиск">
			</li>
			<li>
				<a @click="sortParam='artist'" :class="sortParam==='artist'? 'act' : ''"
					title="Сортировать по исполнителю"><i class="fas fa-user-circle"></i></a>
				<a @click="sortParam='title'" :class="sortParam==='title'? 'act' : ''" title="Сортировать по альбому"><i
						class="fas fa-record-vinyl"></i></a>
				<a @click="sortParam='folder'" :class="sortParam==='folder'? 'act' : ''" title="Сортировать по цену"><i
						class="fas fa-ruble-sign"></i></a>
				<a @click="sortParam='released'" :class="sortParam==='released'? 'act' : ''"><i
						class="far fa-calendar-alt" title="Сортировать по году"></i></a>

				&nbsp; &nbsp; &nbsp;

				<a @click="showlist='b'" :class="showlist==='b'? 'act' : ''" title="Показать картинки"><i
						class="fas fa-th"></i></a>
				<a @click="showlist='t'" :class="showlist==='t'? 'act' : ''" title="Показать таблицу"><i
						class="fas fa-list"></i></a>
			</li>
			<li v-show="count>0">
				<label>
					<a>
						<input type="checkbox" v-model="selected">
						<i class="fas fa-shopping-cart"></i>
						<b>{{sum}}</b> руб,
						{{count}} шт 
					</a>
				</label>
			</li>
		</ul>

		<div v-if="selected">
			<ol>
				<li v-for="x in sortedList" v-bind:key="x.id">
					<input type="checkbox" v-model="checkeds" :value="x.ID">
					{{ x.artist }} &mdash; {{ x.title }} [{{ x.folder }}];
				</li>
			</ol>
		</div>

		<div v-else-if="showlist==='b'" v-for="x in sortedList" v-bind:key="x.id">
			<div class="item">
				<div class="clear">
					<div class="img">
						<label>
							<input type="checkbox" v-model="checkeds" :value="x.ID">
							<img :src="x.thumb">
						</label>
						<div class="prs">
							<font class="rub">{{ x.folder }}</font>
						</div>
					</div>
					<div class="info">
						<p><a :href="x.uri" target="_blank">{{ x.artist }} &mdash; {{ x.title }}</a></p>
						{{ x.released > 0 ? x.released + ' г.' : ''}}
						<i :title="x.country">{{x.labels[0].name}}</i>
						<p class="genres">
							<font v-for="g in x.genres">{{g}}</font>
							<font v-for="s in x.styles">{{s}}</font>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div v-else-if="showlist==='t'">
			<table>
				<tr v-for="x in sortedList" v-bind:key="x.id">
					<td></td>
					<td>Исполнитель</td>
					<td>Альбом</td>
					<td>Цена</td>
					<td>Год</td>
					<td>Лайбл</td>
					<td>Страна</td>
					<td class="genres">Жанр</td>
				</tr>
				<tr v-for="x in sortedList" v-bind:key="x.id">
					<td><input type="checkbox" v-model="checkeds" :value="x.ID"></td>
					<td>{{ x.artist }}</td>
					<td>{{ x.title }}</td>
					<td>
						<font class="rub">{{ x.folder }}</font>
					</td>
					<td>
						<nobr>{{ x.released > 0 ? x.released + ' г.' : ''}}</nobr>
					</td>
					<td>
						<nobr>{{x.labels[0].name}}</nobr>
					</td>
					<td>
						<nobr>{{ x.country }}</nobr>
					</td>
					<td class="genres">
						<font v-for="g in x.genres">{{g}}</font>
						<font v-for="s in x.styles">{{s}}</font>
					</td>
				</tr>
			</table>
		</div>
	</div>
	<footer>
		Страницу сделал
		<a href="https://vk.com/ya432209" target="_blank">Руслан</a>
		(<a href="https://t.me/yakubovich" target="_blank">Telegramm</a>)
	</footer>

	<script>
		var app = new Vue({
			el: '#app',
			data: {
				search: '',
				sortParam: 'artist',
				vinyls: [],
				checkeds: [],
				selected: false,
				showlist: 'b',
			},
			created() {
				fetch('collection.json')
					.then(response => response.json())
					.then(json => {
						this.vinyls = json;
						this.vinyls.forEach(e => {
							e.released = +e.released;
							e.folder = e.notes ? +e.notes : +e.folder;
							e.checked = false;
							e.str = (e.artist + ' ' + e.title + ' ' + e.genres + ' ' + e.styles).toLowerCase();
						})
					})
			},
			methods: {
			},
			computed: {
				count() {
					if (this.checkeds.length == 0)
						this.selected = false;
					return this.checkeds.length;
				},
				sum() {
					var s = 0;
					this.vinyls.forEach(e => {
						if (this.checkeds.indexOf(e.ID) != -1)
							s += e.folder
					})
					return s;
				},
				sortedList() {
					var srch = this.search.trim().toLowerCase();
					var v = [];

					if (this.selected)
						v = this.vinyls.filter(item => {
							return this.checkeds.indexOf(item.ID) > -1
						})
					else
						v = !srch ? this.vinyls :
							this.vinyls.filter(item => {
								return item.str.indexOf(srch) > -1
							})

					switch (this.sortParam) {
						case 'artist': return v.sort(sortByA);
						case 'title': return v.sort(sortByT);
						case 'folder': return v.sort(sortByF);
						case 'released': return v.sort(sortByR);
						default: return v.sort(sortByA);
					}
				}
			}
		})
		var sortByA = (a, b) => { return (a.artist.toLowerCase() > b.artist.toLowerCase()) ? 1 : -1; };
		var sortByT = (a, b) => { return (a.title.toLowerCase() > b.title.toLowerCase()) ? 1 : -1; };
		var sortByF = (a, b) => { return (a.folder > b.folder) ? 1 : -1; };
		var sortByR = (a, b) => { return (a.released > b.released) ? 1 : -1; };
	</script>
</body>

</html>
